name: Daily Generate & Upload GeoGenesis Short

on:
  schedule:
    # 11:30 UTC = 5:00 PM IST
    - cron: '30 11 * * *'
  workflow_dispatch: {}

jobs:
  build_and_upload:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - name: Install system deps (ffmpeg)
        run: sudo apt-get update && sudo apt-get install -y ffmpeg
      - name: Install Python deps
        run: |
          python -m pip install --upgrade pip
          pip install edge-tts pydub pillow google-api-python-client google-auth google-auth-oauthlib google-auth-httplib2 requests python-dotenv
      - name: Generate video
        env:
          OUT_DIR: ready_videos
          FONT_PATH: /usr/share/fonts/truetype/dejavu/DejaVuSans-Bold.ttf
        run: |
          python geogenesis_auto_studio.py
      - name: Upload to YouTube
        env:
          CLIENT_ID: ${{ secrets.CLIENT_ID }}
          CLIENT_SECRET: ${{ secrets.CLIENT_SECRET }}
          REFRESH_TOKEN: ${{ secrets.REFRESH_TOKEN }}
          TITLE_PREFIX: ${{ secrets.TITLE_PREFIX }}
          HASHTAGS: ${{ secrets.HASHTAGS }}
          VIDEO_DIR: ready_videos
          PRIVACY_STATUS: public
        run: |
          python yt_shorts_uploader.py
