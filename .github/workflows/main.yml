name: Daily Generate & Upload GeoGenesis Short

on:
  schedule:
    # 11:30 UTC = 5:00 PM IST
    - cron: '30 11 * * *'
  workflow_dispatch:

jobs:
  build_and_upload:
    runs-on: ubuntu-latest

    steps:
      # Checkout your repository
      - name: Checkout repository
        uses: actions/checkout@v4

      # Setup Python
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      # Install system dependencies
      - name: Install system packages
        run: |
          sudo apt-get update
          sudo apt-get install -y ffmpeg

      # Install Python dependencies
      - name: Install Python dependencies
        run: |
          python -m pip install --upgrade pip
          pip install gtts pydub pillow google-api-python-client google-auth google-auth-oauthlib google-auth-httplib2 requests python-dotenv

      # Generate and render short
      - name: Generate video short
        env:
          OUT_DIR: ready_videos
          FONT_PATH: /usr/share/fonts/truetype/dejavu/DejaVuSans-Bold.ttf
        run: |
          python GeoGenesis-AI-Shorts-v2/GeoGenesis-AI-Shorts/geogenesis_auto_studio.py

      # Upload to YouTube
      - name: Upload to YouTube
        env:
          CLIENT_ID: ${{ secrets.CLIENT_ID }}
          CLIENT_SECRET: ${{ secrets.CLIENT_SECRET }}
          REFRESH_TOKEN: ${{ secrets.REFRESH_TOKEN }}
          TITLE_PREFIX: ${{ secrets.TITLE_PREFIX }}
          HASHTAGS: ${{ secrets.HASHTAGS }}
        run: |
          python GeoGenesis-AI-Shorts-v2/GeoGenesis-AI-Shorts/yt_shorts_uploader.py

      # Optional cleanup (to keep repo light)
      - name: Cleanup older videos
        run: |
          find ready_videos -type f -mtime +3 -delete
